# emg Makefile
# for modern POSIX systems

PREFIX ?=	/usr/local

CC ?=		cc

# Some basic CFLAGS.
CFLAGS ?=	-O2 -pipe -Wall -Werror

# Do we need strtonum?
CFLAGS +=	-DHAVE_STRTONUM

# With the extra LDFLAGS, save some bytes.
CFLAGS +=	-ffunction-sections -fdata-sections

# with CFLAGS+=	-ffunction-sections -fdata-sections
LDFLAGS +=	-Wl,--gc-sections

LIBS =		-ltermcap

OBJS =	basic.o buffer.o display.o file.o fileio.o line.o main.o \
	random.o region.o search.o tcap.o ttyio.o window.o word.o

# Do we need strtonum?
OBJS +=	strtonum.o

all:	emg

emg:	${OBJS}
	${CC} ${LDFLAGS} -o emg ${OBJS} ${LIBS}

install: all
	install -c -s -m 755 emg ${PREFIX}/bin/emg
	install -c -m 644 emg.1 ${PREFIX}/man/man1
	install -d -m 755 ${PREFIX}/share/doc/emg
	install -c -m 644 emg.keys ${PREFIX}/share/doc/emg/emg.keys

clean:
	rm -f *.o *~ *.core *.bak emg

distclean: clean
	rm -f Makefile
